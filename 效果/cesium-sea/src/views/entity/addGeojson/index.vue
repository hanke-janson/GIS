<template>
  <!-- https://blog.csdn.net/weixin_43312391/article/details/124692377 -->
  <div id="cesiumContainerGeojson" />
</template>
<script lang="ts">
import { defineComponent, reactive, toRefs, onMounted } from "vue";
import * as Cesium from "cesium";
import $Earth from "@/earth/index";
let viewer: any;
import dataItem from "./data";
import wkt from "terraformer-wkt-parser";
export default defineComponent({
  name: "App",
  setup() {
    const data = reactive({});
    const init = () => {
      let earthMap = new $Earth("cesiumContainerGeojson"); // 控件实例
      viewer = earthMap.initMap();
      for (let i = 0; i < dataItem.length; i++) {
        if (dataItem[i].extent) {
          let geo = wkt.parse(dataItem[i].extent);
          addGeoJson(geo, "#fff");
        }
      }
    };

    let addGeoJson = (urlStr: any, colorStr: string) => {
      let color = Cesium.Color.fromCssColorString(colorStr);
      // 第一种加载方式
      //   let promise = viewer.dataSources.add(
      //     Cesium.GeoJsonDataSource.load(urlStr, {
      //       stroke: Cesium.Color.BLUE.withAlpha(0.8),
      //       strokeWidth: 2.3,
      //       fill: Cesium.Color.RED.withAlpha(0.3),
      //       clampToGround: true,
      //     })
      //   );
      //   viewer.flyTo(promise);

      //   方式二
      Cesium.GeoJsonDataSource.load(urlStr).then(
        (dataSource: Cesium.DataSource) => {
          let entities = dataSource.entities.values;
          for (let i = 0; i < entities.length; i++) {
            let entity: Cesium.Entity = entities[i];
            entity.polyline = new Cesium.PolylineGraphics({
              clampToGround: true,
              width: 5,
              material: color,
            });
            // entity.polygon = new Cesium.PolygonGraphics({
            //   material: color,
            //   height: 10,
            // });
          }
          viewer.dataSources.add(dataSource);
        }
      );
    };

    onMounted(() => {
      // init();
      let extent =
        "POLYGON((113.479146836493 34.8220804896792,113.532184414312 34.8119439286739,113.595652899735 34.7999125114372,113.596204799608 34.7998205281249,113.596241592933 34.7999860980869,113.596315179583 34.7999860980869,113.596259989596 34.7998021314625,113.596315179583 34.7998021314625,113.596333576245 34.799949304762,113.596407162895 34.7999677014245,113.596388766233 34.7997837348001,113.59644395622 34.7997653381376,113.596535939532 34.7997653381376,113.596572732857 34.7999309080996,113.596903872781 34.7998757181123,113.597437375992 34.7997653381376,113.597400582667 34.7995997681757,113.597602945954 34.7995445781883,113.597694929266 34.7995445781883,113.597731722591 34.7996917514879,113.597768515916 34.7997101481503,113.601668608353 34.7989742816526,113.601687005016 34.7988822983404,113.601650211691 34.7987903150282,113.601723798341 34.7987903150282,113.601760591666 34.7989374883278,113.60187097164 34.7989374883278,113.602312491539 34.7988455050155,113.602275698214 34.7986615383911,113.602680424788 34.7986063484038,113.602717218113 34.7987719183658,113.60284599475 34.7987535217033,113.666259290186 34.7867956911164,113.72634278972 34.775573727027,113.726397979707 34.7755553303646,113.726361186382 34.7754265537275,113.726434773032 34.7755553303646,113.729102289086 34.7750586204787,113.729065495761 34.7749298438416,113.729120685748 34.7749114471791,113.729690982284 34.7748194638669,113.729709378946 34.7749298438416,113.729764568934 34.7749298438416,113.729746172271 34.7748010672045,113.730095708858 34.7747274805547,113.731291491916 34.7745067206054,113.731346681904 34.7745067206054,113.731365078566 34.7746171005801,113.731457061878 34.7746171005801,113.731549045191 34.7745987039176,113.731530648528 34.7744699272805,113.731677821828 34.7744331339556,113.731880185114 34.7744147372932,113.731880185114 34.774488323943,113.731935375102 34.7745251172679,113.731916978439 34.7743963406308,113.731972168427 34.7743963406308,113.732008961752 34.7745067206054,113.732358498338 34.7744515306181,113.732744828249 34.7743779439683,113.732726431587 34.7742491673312,113.732763224912 34.7742307706688,113.733646264709 34.7740652007068,113.80184269238 34.7613899002846,113.84961882474 34.7525778989751,113.805246074931 34.5924717457465,113.764534260948 34.4450960829275,113.729323049035 34.4515901047694,113.672900485327 34.462076202361,113.575416571049 34.480325691503,113.480894519425 34.4981888507337,113.431241927495 34.5076447352287,113.395460419046 34.5145066903194,113.437993502611 34.6710806843592,113.479146836493 34.8220804896792),(113.702647888495 34.7440786409271,113.70268468182 34.7440602442647,113.70268468182 34.7441338309145,113.702647888495 34.7440786409271),(113.702592698508 34.7441338309145,113.70261109517 34.7440602442647,113.702629491832 34.744115434252,113.702592698508 34.7441338309145),(113.702500715195 34.7442442108891,113.702555905183 34.7442074175642,113.702555905183 34.7442626075515,113.702500715195 34.7442442108891),(113.660501134841 34.7412455549111,113.660482738179 34.7412087615863,113.660519531504 34.7412087615863,113.660501134841 34.7412455549111),(113.596333576245 34.5059706389465,113.596333576245 34.5059338456216,113.59637036957 34.5059338456216,113.596333576245 34.5059706389465),(113.589085291243 34.6558482478576,113.589085291243 34.6558114545327,113.589122084568 34.6558114545327,113.589085291243 34.6558482478576),(113.537740206369 34.6603186368309,113.537776999694 34.6603002401684,113.537776999694 34.6603370334933,113.537740206369 34.6603186368309))";

      console.log(wkt.parse(extent));
    });
    const refData = toRefs(data);
    return {
      ...refData,
      init,
    };
  },
});
</script>
<style lang="scss" scoped>
#cesiumContainerGeojson {
  width: 100%;
  height: 100%;
}
</style>
